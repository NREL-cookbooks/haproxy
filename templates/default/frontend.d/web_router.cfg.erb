####################################################################
##### GENEARTED BY CHEF. LOCAL MODIFICATIONS WILL BE REPLACED. #####
####################################################################

frontend web_router <%= node[:haproxy][:web_router][:bind_address] %>:80
  option forwardfor

  <% node[:haproxy][:web_router][:domains].each do |domain_options| %>
  # <%= domain_options[:domain] %>
  acl host_match_<%= domain_options[:id] %> hdr_beg(host) -i <%= domain_options[:domain] %>
  use_backend <%= domain_options[:id] %>_farm if host_match_<%= domain_options[:id] %>
  <% end %>

  <% if node.role?("developer_web") %>
  # Requests starting with /api get sent to the auth proxy for authentication
  # and rate limiting.
  acl url_match_api path_beg /api/
  use_backend auth_proxy_farm if url_match_api

  # All other requests go to our main site.
  default_backend public_site_farm
  <% end %>
